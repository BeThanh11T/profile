<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chuy·ªÉn link Shopee Affiliate</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 40px; }
    input, button, textarea { width: 100%; margin-top: 10px; padding: 10px; font-size: 16px; }
    button { background: #ee4d2d; color: white; border: none; cursor: pointer; }
    button:hover { background: #d94425; }
  </style>
</head>
<body>

  <h2>üîó Chuy·ªÉn ƒë·ªïi Link Shopee Affiliate</h2>
  <label for="inputLink">Nh·∫≠p link Shopee (d√†i ho·∫∑c r√∫t g·ªçn):</label>
  <input type="text" id="inputLink" placeholder="https://s.shopee.vn/abc123 ho·∫∑c https://shopee.vn/..." />

  <button onclick="convertLink()">Chuy·ªÉn ƒë·ªïi</button>

  <label for="outputLink">üîó Link Affiliate:</label>
  <textarea id="outputLink" rows="3" readonly></textarea>

  <script>
    async function resolveShortUrl(url) {
      try {
        const response = await fetch(url, { method: 'HEAD', redirect: 'follow' });
        return response.url;
      } catch (err) {
        alert("Kh√¥ng th·ªÉ gi·∫£i m√£ link r√∫t g·ªçn!");
        return null;
      }
    }

    async function convertLink() {
      const input = document.getElementById("inputLink").value.trim();
      const output = document.getElementById("outputLink");
      output.value = "ƒêang x·ª≠ l√Ω...";

      let finalUrl = input;

      // N·∫øu l√† link r√∫t g·ªçn
      if (input.includes("s.shopee.vn")) {
        const resolved = await resolveShortUrl(input);
        if (resolved) finalUrl = resolved;
        else {
          output.value = "L·ªói: kh√¥ng th·ªÉ gi·∫£i m√£ link r√∫t g·ªçn.";
          return;
        }
      }

      // Th√™m affiliate ID n·∫øu ch∆∞a c√≥
      let affId = "17358980251";
      let newUrl = new URL(finalUrl);
      newUrl.searchParams.set("af_id", affId);

      output.value = newUrl.toString();
    }
  </script>

</body>
</html>
