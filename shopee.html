<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>PhÃ¢n tÃ­ch CSV Shopee</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial; padding: 30px; max-width: 650px; margin: auto; }
    input, textarea, button { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; }
    button { background: #ee4d2d; color: white; border: none; cursor: pointer; }
    button:hover { background: #d94425; }
    #result { font-weight: bold; margin-top: 20px; color: #2c3e50; font-size: 18px; line-height: 1.6; }
  </style>
</head>
<body>

<h2>ğŸ“Š PhÃ¢n tÃ­ch Shopee affiliate</h2>

<input type="file" id="csvFile" accept=".csv">
<div id="result">ChÆ°a cÃ³ dá»¯ liá»‡u.</div>
<button onclick="copyResult()">ğŸ“‹ Sao chÃ©p káº¿t quáº£</button>

<script>
  document.getElementById('csvFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        const data = results.data;
        let totalAK = 0;
        let validOrders = 0;

        const keys = Object.keys(data[0]);
        const akKey = keys[36];     // Cá»™t AK: vá»‹ trÃ­ 37 (index 36)
        const statusKey = keys[1];  // Cá»™t B: Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng

        data.forEach(row => {
          // Tá»•ng cá»™t AK
          let raw = row[akKey];
          if (typeof raw === 'string') {
            raw = raw.replace(/â‚«|,/g, '').trim(); // loáº¡i kÃ½ tá»± tiá»n tá»‡
          }
          const value = parseFloat(raw);
          if (!isNaN(value)) totalAK += value;

          // Äáº¿m Ä‘Æ¡n há»£p lá»‡
          const status = row[statusKey]?.toLowerCase();
          if (status && !status.includes("há»§y") && !status.includes("huá»·")) {
            validOrders++;
          }
        });

        const resultText = 
          `ğŸ”¢ <strong>Tiá»n hoa há»“ng:</strong> ${totalAK.toLocaleString('vi-VN')}<br>` +
          `ğŸ“¦ <strong>Sá»‘ Ä‘Æ¡n hÃ ng:</strong> ${validOrders}`;
        document.getElementById('result').innerHTML = resultText;
      }
    });
  });

  function copyResult() {
    const text = document.getElementById('result').innerText;
    navigator.clipboard.writeText(text)
      .then(() => alert("âœ… ÄÃ£ sao chÃ©p vÃ o clipboard!"))
      .catch(() => alert("âŒ KhÃ´ng thá»ƒ sao chÃ©p."));
  }
</script>

</body>
</html>
